<html>

<head>
	<title>Flag Dependencies Demo - Optimizely Full Stack</title>
	<meta name="description" content="A demo of dependent flags using Optimizely Full Stack">
	<meta name="author" content="Peter Koomen">

	<!--<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>-->
	<script defer src="./js/alpine.cdn.min.js"></script>
	<script type="module">
		import * as optimizely from "./js/flag_dependencies.js";

		// Load default static datafile
		fetch("./js/8Aee8gXFsj4apUcNx59TD.json").then(response => {
			return response.json();
		}).then(datafile => {

			window.decideWithDependencies = (flagKey, userId, attrs = {}) => {
				let optimizelyClient = optimizely.createInstance({
					datafile: datafile
				});
				let user = optimizelyClient.createUserContext(userId, attrs);
				return optimizelyClient.decideWithDependencies(user, flagKey);
			};

		})

	</script>

	<link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/skeleton.css">
	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="css/index.css">
</head>

<body>
	<div class="container" x-data=" { 
		sdkKey: 'abc123',
		userId: 'user1234567', 
		attrs: {
			'in_audience_1': false,
			'in_audience_2': false
		}
	}">

		<div class="global-config">
			<div class="row">
				<div class="three columns">
					sdkKey:
				</div>
				<div class="three columns">
					<input type="text" x-model="sdkKey"></input>
				</div>
			</div>
			<div class="row">
				<div class="three columns">
					userId:
				</div>
				<div class="three columns">
					<input type="text" x-model="userId"></input>
				</div>
			</div>

		</div>

		<section class="header">
			<h2 class="title">Flag Dependencies Demo</h2>
		</section>

		<div class="docs-section" id="intro">

			<h6 class="docs-header">What are flag dependencies?</h6>
			<p>First things first: a
				<a
					href="https://docs.developers.optimizely.com/experimentation/v4.0.0-full-stack/docs/create-feature-flags">
					feature flag</a> allows you to turn software functionality on or off, or otherwise configure its
				behavior, without deploying new code.
			</p>

			<p>Here's an example of a feature flag that uses a 50/50 <a
					href="https://docs.developers.optimizely.com/experimentation/v4.0.0-full-stack/docs/run-a-b-tests">A/B
					test rule</a> to decide whether it is
				<span class="on">on</span> or <span class="off">off</span>. Try changing the <code>userId</code> value
				in the upper-right and then click the "Decide" button.
			</p>

			<div class="flag" x-data="{ flagKey: 'example_flag', variationKey: '...' }">
				<a class="button button-primary u-pull-right"
					@click="variationKey = window.decideWithDependencies(flagKey, userId, attrs).variationKey"
					href="#">Decide</a>
				<div class="flag-cfg">
					flagKey: <span x-text="flagKey"></span><br />
					variation: <span x-text="variationKey" :class="variationKey == 'off' ? 'off' : 'on'"></span>
				</div>
			</div>
		</div>

	</div>
	</div>
	</div>

</body>

</html>